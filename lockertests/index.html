<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Mirrasets â€” AQUAm25 Locker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Freighter API (UMD global) -->
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/stellar-freighter-api/5.0.0/index.min.js"
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  ></script>

  <!-- Stellar SDK (UMD) -->
  <script
    src="https://cdn.jsdelivr.net/npm/@stellar/stellar-sdk@14/dist/stellar-sdk.min.js"
    crossorigin="anonymous"
  ></script>

  <style>
    :root{--bg:#0b1220;--card:#121a2b;--border:#233055;--muted:#8ea2ff}
    body{margin:0;padding:28px;background:var(--bg);color:#f1f5ff;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
    .wrap{max-width:980px;margin:0 auto}
    .card{background:#121a2b;border:1px solid #233055;border-radius:16px;padding:22px}
    h1{margin:0 0 10px} h2{margin:18px 0 8px}
    p{margin:.25rem 0 .75rem;opacity:.96}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .muted{opacity:.85} .small{font-size:12px;opacity:.8}
    button{cursor:pointer;font-weight:600;border-radius:10px;border:1px solid #3a4a7a;background:#1a2550;color:#fff;padding:10px 14px}
    button:hover{filter:brightness(1.08)} button.ghost{background:transparent}
    input,textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #2a3d7a;background:#0b1430;color:#fff}
    input[readonly]{opacity:.9;background:#0a1230;border-style:dashed}
    label{display:block;margin:10px 0 6px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .section{margin-top:18px;padding-top:14px;border-top:1px dashed #2b3b6a}

    /* Locker area */
    .locker{display:grid;grid-template-columns:1.2fr .8fr;gap:16px}
    @media (max-width:840px){.locker{grid-template-columns:1fr}}
    .box{background:#0e1627;border:1px solid #22315c;border-radius:12px;padding:14px}
    .pct{display:flex;gap:8px;margin-top:6px}
    .pct button{flex:1;background:#162554;border:1px solid #344a8a}

    /* Connect modal */
    .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center}
    .open{display:flex}
    .modal-inner{width:min(560px,92vw);background:#0e1627;border:1px solid #22315c;border-radius:16px;padding:22px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .x{background:none;border:none;color:var(--muted);font-size:22px;line-height:1;cursor:pointer}
    .wallet-btn{width:100%;padding:14px 16px;display:flex;align-items:center;justify-content:center;gap:10px;margin-top:10px}
    .qr-wrap{display:flex;flex-direction:column;align-items:center;gap:12px;margin-top:12px}
    .wallet-choices{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
    .wallet-choices button{background:#162554;border:1px solid #344a8a}
    a.link{color:#9ab0ff;text-decoration:underline}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>AQUAm25 Interest Earning Locker</h1>
      <p>Earn interest on your AQUAm25 by locking it for 1 year! Simply enter a <b>Public Key</b> manually or connect a wallet, then proceed to lock. We'll send your interest every week on Sundays until your lock ends, at which point you'll need to relock to continue earning interest.</p>

      <div class="row" style="margin-top:8px">
        <button id="connectBtn">Connect Wallet</button>
        <button id="disconnectBtn" class="ghost" disabled>Disconnect</button>
        <span id="status" class="muted">Not connected</span>
      </div>

      <div class="section locker">
        <!-- Left: Locker inputs -->
        <div class="box">
          <h2>Locker</h2>

          <label for="pubkey">Public Key</label>
          <input id="pubkey" placeholder="Gâ€¦ (manual entry allowed if not connected)" />

          <p class="small">AQUAm25 Balance: <b id="aquaBal">-</b></p>

          <label for="amount">AQUAm25 Amount</label>
          <input id="amount" type="number" step="any" placeholder="Amount to lock" />
          <div class="pct">
            <button data-pct="25">25%</button>
            <button data-pct="50">50%</button>
            <button data-pct="75">75%</button>
            <button data-pct="100">100%</button>
          </div>

          <p id="lockInfo" class="small" style="margin-top:8px;white-space:pre-line;opacity:.9"></p>

          <div class="row" style="margin-top:8px">
            <button id="buildBtn">Build Lock XDR</button>
            <span id="buildStatus" class="small"></span>
          </div>

          <label for="xdrOut" style="margin-top:10px">Transaction XDR</label>
          <textarea id="xdrOut" rows="6" placeholder="Built XDR appears here"></textarea>

          <div class="row" style="margin-top:10px">
            <button id="signSubmitBtn">Sign &amp; Submit (current wallet)</button>
            <button id="signOnlyBtn" class="ghost">Sign (donâ€™t submit)</button>
            <button id="copyBtn" class="ghost">Copy XDR</button>
            <button id="labBtn" class="ghost">Open in Stellar Lab</button>
          </div>

          <p id="actionResult" class="small" style="margin-top:6px"></p>
        </div>

        <!-- Right: Connection state -->
        <div class="box">
          <h2>Connection</h2>
          <p class="small">Mode: <b id="mode">â€”</b></p>
          <p class="small">Address: <span id="addr" style="word-break:break-all"></span></p>
          <p class="small">Network: <b>Public</b></p>
          <p class="small">Tip: Using mobile? Choose LOBSTR or Freighter from the WalletConnect popup.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Connect Modal -->
  <div id="backdrop" class="backdrop"></div>
  <div id="loginModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
    <div class="modal-inner">
      <div class="modal-header">
        <h2 id="loginTitle" style="font-size:18px;margin:0">Connect Wallet</h2>
        <button class="x" id="closeModal" aria-label="Close">Ã—</button>
      </div>
      <p>Select a login method:</p>
      <button class="wallet-btn" id="wcBtn">ðŸ”— WalletConnect (mobile)</button>
      <button class="wallet-btn" id="freighterExtBtn">ðŸ§© Freighter (browser extension)</button>

      <div id="qrArea" class="qr-wrap" style="display:none">
        <canvas id="qrCanvas" width="256" height="256" style="background:#fff;border-radius:12px"></canvas>
        <div class="wallet-choices">
          <button id="btnLobstr">Open in LOBSTR</button>
          <button id="btnFreighter">Open in Freighter</button>
        </div>
        <div class="small">
          Scan with your wallet app (LOBSTR / Freighter), or tap a button above on mobile. Â·
          <a id="rawWcLink" class="link" href="#" target="_blank" rel="noreferrer">raw wc link</a>
        </div>
        <p id="linkStatus" class="small" style="margin:0;text-align:center;opacity:.8"></p>
      </div>
    </div>
  </div>

  <script>window.process = window.process || { env: {} };</script>

  <script type="module">
    import SignClient from "https://esm.sh/@walletconnect/sign-client@2.21.8";
    import QRCode     from "https://esm.sh/qrcode@1.5.3";

    // ---------- Config ----------
    const PROJECT_ID = "f658ce3a7c8a185214974f71539fea39";
    const EXPLORER   = "https://explorer-api.walletconnect.com/v3/wallets";
    const HORIZON    = "https://horizon.stellar.org";
    const NETWORK    = window.StellarSdk.Networks.PUBLIC;

    // AQUAm25 specifics
    const AQUA_CODE   = "AQUAm25";
    const AQUA_ISSUER = "GDXF6SYWIQOKOZ7BACXHBFBLQZEIH25KOTTLWQK35GO3JKRNIFHHGBPC";
    const TRACKER_KEY = "GDGEWZMIJ2K6AEYYV2L4FYN27YJP5OVZSWCJIM662D5OS7EL6T6WBGBP";

    const STORE = {
      lobstr:   { ios:"https://apps.apple.com/app/id1404357892",                      android:"https://play.google.com/store/apps/details?id=com.lobstr.client" },
      freighter:{ ios:"https://apps.apple.com/app/freighter/id6743947720",           android:"https://play.google.com/store/apps/details?id=org.stellar.freighterwallet&pli=1" }
    };

    // ---------- DOM ----------
    const $=(id)=>document.getElementById(id);
    const on=(el,ev,fn)=>el&&el.addEventListener(ev,fn);
    const isIOS=()=>/iPhone|iPad|iPod/i.test(navigator.userAgent);

    const connectBtn=$("connectBtn"), disconnectBtn=$("disconnectBtn"), statusEl=$("status");
    const backdrop=$("backdrop"), loginModal=$("loginModal"), closeModalBtn=$("closeModal"), wcBtn=$("wcBtn"), freighterExtBtn=$("freighterExtBtn");
    const qrArea=$("qrArea"), qrCanvas=$("qrCanvas"), linkStatus=$("linkStatus"), btnLobstr=$("btnLobstr"), btnFreighter=$("btnFreighter"), rawWcLink=$("rawWcLink");

    const pubkeyEl=$("pubkey"), aquaBalEl=$("aquaBal"), amountEl=$("amount"), lockInfoEl=$("lockInfo");
    const buildBtn=$("buildBtn"), buildStatus=$("buildStatus"), xdrOut=$("xdrOut");
    const signSubmitBtn=$("signSubmitBtn"), signOnlyBtn=$("signOnlyBtn"), copyBtn=$("copyBtn"), labBtn=$("labBtn"), actionResult=$("actionResult");
    const addrEl=$("addr"), modeEl=$("mode");
    const pctBtns=[...document.querySelectorAll(".pct button")];

    // ---------- UI helpers ----------
    const openModal=()=>{backdrop.classList.add("open");loginModal.classList.add("open");};
    const closeModal=()=>{backdrop.classList.remove("open");loginModal.classList.remove("open");};
    on(closeModalBtn,"click",closeModal); on(backdrop,"click",closeModal);
    on(connectBtn,"click",openModal);

    // ---------- Stellar SDK setup (SAFE Server detection) ----------
    if(!window.StellarSdk) throw new Error("Stellar SDK failed to load.");
    const SDK = window.StellarSdk;
    const ServerCtor = SDK.Server || (SDK.Horizon && SDK.Horizon.Server);
    if (!ServerCtor) { throw new Error("Stellar SDK: Server constructor not found."); }
    let _server=null; const getServer=()=>(_server ||= new ServerCtor(HORIZON));
    const AQUA = new SDK.Asset(AQUA_CODE, AQUA_ISSUER);

    // ---------- Connection state ----------
    // 'none' | 'wc' | 'freighter'
    let connectionMode="none";
    let client=null, session=null, latestWcUri=null;

    function updateActionButtons(){
      const hasXdr = !!xdrOut.value.trim();
      signOnlyBtn.disabled   = (connectionMode==="none") || !hasXdr;
      signSubmitBtn.disabled = (connectionMode==="none") || !hasXdr;
      copyBtn.disabled       = !hasXdr;
      labBtn.disabled        = !hasXdr;
    }

    async function ensureClient(){
      if(!client){ client = await SignClient.init({ projectId: PROJECT_ID }); }
    }
    async function ensureFreighterApi(){
      if (window.freighterApi) return window.freighterApi;
      try{
        const mod = await import('https://esm.sh/@stellar/freighter-api@5.0.0');
        window.freighterApi = mod?.default ?? mod;
        return window.freighterApi;
      }catch{ return null; }
    }

    function setConnected(address, mode){
      addrEl.textContent = address || "";
      modeEl.textContent = mode==="wc"?"WalletConnect":(mode==="freighter"?"Freighter extension":"â€”");
      statusEl.textContent = address ? `Connected (${modeEl.textContent})` : "Not connected";
      disconnectBtn.disabled = !address;

      // When connected: lock the pubkey field to prevent edits
      if(address && /^G[A-Z2-7]{55}$/.test(address)){
        pubkeyEl.value = address;
        pubkeyEl.readOnly = true;
        fetchAquaBalance();
        scheduleBuild(); // auto-build with connected key
      }else{
        pubkeyEl.readOnly = false;
      }
      updateActionButtons();
    }

    on(disconnectBtn,"click", async ()=>{
      try{
        if(connectionMode==="wc" && client && session){
          await client.disconnect({ topic: session.topic, reason:{ code:6000, message:"User disconnected" }});
        }
      }catch(e){ console.warn(e); }
      session=null; connectionMode="none"; setConnected("", "none");
    });

    // ---------- WalletConnect (mobile) ----------
    function openLobstrApp(uri){
      const scheme = `lobstr://wc?uri=${encodeURIComponent(uri)}`;
      const store  = isIOS()? STORE.lobstr.ios : STORE.lobstr.android;
      const t0 = Date.now();
      window.location.href = scheme;
      setTimeout(()=>{ if(!document.hidden && Date.now()-t0<2000){ window.open(store, "_blank", "noopener"); } }, 1800);
    }

    async function getFreighterLinks(){
      try{
        const url = `${EXPLORER}?projectId=${encodeURIComponent(PROJECT_ID)}&entries=200&page=1`;
        const res = await fetch(url); const data = await res.json();
        const raw = data?.listings ?? data?.data ?? [];
        const arr = Array.isArray(raw) ? raw : Object.values(raw);
        const w = arr.find(it => ((it.name||it.app?.name||"").toLowerCase()).includes("freighter"));
        const mobile = w?.mobile || w?.app?.mobile || {};
        return { native: mobile.native||mobile.nativeLink||null, universal: mobile.universal||mobile.universalLink||null, found: !!w };
      }catch{ return {native:null,universal:null,found:false}; }
    }
    function buildCandidates(base, wcUri){
      if(!base) return [];
      const enc = encodeURIComponent(wcUri);
      if (base.includes("{wc}") || base.includes("{URI}")) return [ base.replace("{wc}",enc).replace("{URI}",enc) ];
      const j = base.includes("?") ? "&" : "?";
      return [ `${base}${j}wc=${enc}`, `${base}${j}uri=${enc}` ];
    }
    function openFreighterSmart(links, wcUri){
      const store = isIOS()? STORE.freighter.ios : STORE.freighter.android;
      const natives = buildCandidates(links.native, wcUri);
      const universals = buildCandidates(links.universal, wcUri);
      let attempted=false;
      for(const href of natives){ attempted=true; window.location.href = href; setTimeout(()=>{},350); }
      if(universals.length){ attempted=true; window.open(universals[0], "_blank", "noopener"); }
      if(!attempted){ window.open(store, "_blank", "noopener"); }
    }

    on(wcBtn,"click", async ()=>{
      try{
        await ensureClient();
        statusEl.textContent = "Starting WalletConnectâ€¦";
        const { uri, approval } = await client.connect({
          optionalNamespaces: {
            stellar: { chains:["stellar:pubnet"], methods:["stellar_signXDR","stellar_signAndSubmitXDR"], events:[] }
          }
        });
        if(!uri) throw new Error("No WC URI");
        latestWcUri = uri;

        await QRCode.toCanvas(qrCanvas, uri, { width:256, margin:1 });
        qrArea.style.display = "flex";
        rawWcLink.href = uri;

        linkStatus.textContent = "Loading Freighter deep linkâ€¦";
        const freighterLinks = await getFreighterLinks();
        linkStatus.textContent = freighterLinks.found ? "" : "Freighter link not found â€” store fallback.";

        const bL = btnLobstr.cloneNode(true), bF = btnFreighter.cloneNode(true);
        btnLobstr.replaceWith(bL); btnFreighter.replaceWith(bF);
        bL.addEventListener("click", ()=> openLobstrApp(latestWcUri));
        bF.addEventListener("click", ()=> openFreighterSmart(freighterLinks, latestWcUri));

        session = await approval();
        connectionMode="wc";
        qrArea.style.display="none"; closeModal();

        const accounts = session.namespaces?.stellar?.accounts || [];
        const first = accounts.find(a=>a.startsWith("stellar:pubnet")) || accounts[0] || "";
        const address = first.split(":")[2] || "";
        setConnected(address, "wc");
      }catch(e){
        console.error(e);
        statusEl.textContent = "Connection canceled or failed.";
      }
    });

    // ---------- Freighter extension ----------
    on(freighterExtBtn,"click", async ()=>{
      try{
        const freighter = await ensureFreighterApi();
        if(!freighter){ alert("Freighter extension not detected."); return; }

        let address = "";
        try { address = await freighter.getPublicKey(); } catch {}
        if(!address && freighter.getAddress){ const r=await freighter.getAddress(); address=r?.address||""; }
        if(!address && freighter.requestAccess){ const r=await freighter.requestAccess(); address=r?.address||""; }
        if(!address){ alert("Freighter connect denied or failed."); return; }

        connectionMode="freighter";
        closeModal();
        setConnected(address, "freighter");
      }catch(e){ console.error(e); alert("Freighter connect failed."); }
    });

    // ---------- Balance + locker helpers ----------
    function isValidG(k){ try{return SDK.StrKey.isValidEd25519PublicKey(k);}catch{return false;} }
    function cleanAmt(a){ const n=Number(a); if(!isFinite(n)||n<=0) return null; return n.toFixed(7).replace(/\.0+$/,""); }

    async function fetchAquaBalance(){
      const pk = pubkeyEl.value.trim();
      if(!isValidG(pk)){ aquaBalEl.textContent = "Invalid key"; return; }
      try{
        const acct = await getServer().loadAccount(pk);
        const bal = acct.balances.find(b => b.asset_code===AQUA_CODE && b.asset_issuer===AQUA_ISSUER);
        aquaBalEl.textContent = bal ? bal.balance : "0";
      }catch(e){ console.error(e); aquaBalEl.textContent="Error"; }
    }

    // ---------- Debounced auto-build ----------
    let buildTimer=null;
    function scheduleBuild(){
      buildStatus.textContent = "";
      if(buildTimer) clearTimeout(buildTimer);
      buildTimer = setTimeout(async ()=>{
        const xdr = await buildLockXDR();
        if(xdr){
          xdrOut.value = xdr;
          buildStatus.textContent = "Built âœ“ (auto)";
        }else{
          xdrOut.value = "";
          updateActionButtons();
        }
        updateActionButtons();
      }, 700);
    }

    pubkeyEl.addEventListener("input", ()=>{
      if (pubkeyEl.readOnly) return;      // locked when connected
      fetchAquaBalance();                  // try to show balance quickly
      scheduleBuild();                     // rebuild with new key
    });
    pubkeyEl.addEventListener("change", ()=>{
      if (pubkeyEl.readOnly) return;
      fetchAquaBalance();
      scheduleBuild();
    });

    amountEl.addEventListener("input", scheduleBuild);

    pctBtns.forEach(btn=>btn.addEventListener("click", ()=>{
      const bal = parseFloat(aquaBalEl.textContent)||0;
      const pct = parseInt(btn.dataset.pct,10)/100;
      const v = cleanAmt(bal*pct);
      amountEl.value = v||"";
      scheduleBuild();
    }));

    // Manual button still available (runs immediate)
    on(buildBtn,"click", async ()=>{
      if(buildTimer) clearTimeout(buildTimer);
      buildStatus.textContent="Buildingâ€¦";
      const xdr = await buildLockXDR();
      if(xdr){ xdrOut.value=xdr; buildStatus.textContent="Built âœ“"; }
      else { xdrOut.value=""; }
      updateActionButtons();
    });

    // ---------- Build lock XDR ----------
    async function buildLockXDR(){
      const pk = pubkeyEl.value.trim();
      const amt = cleanAmt(amountEl.value.trim());
      if(!isValidG(pk)){ buildStatus.textContent="Invalid public key."; return null; }
      if(!amt){ buildStatus.textContent="Enter a positive amount."; return null; }

      try{
        const src = await getServer().loadAccount(pk);

        const now = new Date();
        const end = new Date(now);
        end.setUTCFullYear(end.getUTCFullYear()+1);
        end.setUTCHours(23,59,59,0);
        lockInfoEl.textContent = `Lock start: ${now.toLocaleString()}\nLock end:   ${end.toLocaleString(undefined,{timeZone:'UTC'})}`;

        const endTs = Math.floor(end.getTime()/1000).toString();
        const claimants = [
          new SDK.Claimant(pk, SDK.Claimant.predicateNot(SDK.Claimant.predicateBeforeAbsoluteTime(endTs))),
          new SDK.Claimant(TRACKER_KEY, SDK.Claimant.predicateBeforeAbsoluteTime("0"))
        ];

        const tx = new SDK.TransactionBuilder(src, { fee: 20000, networkPassphrase: NETWORK })
          .addOperation(SDK.Operation.createClaimableBalance({ asset: AQUA, amount: amt, claimants }))
          .setTimeout(180)
          .build();

        return tx.toXDR();
      }catch(e){ console.error(e); buildStatus.textContent="Failed to build XDR."; return null; }
    }

    // ---------- Signing helpers ----------
    const wcRequest = (method, xdr) => client.request({
      topic: session.topic, chainId: "stellar:pubnet",
      request: { jsonrpc:"2.0", method, params:{ xdr } }
    });

    async function signCurrent(xdr){
      if(connectionMode==="wc"){
        const r = await wcRequest("stellar_signXDR", xdr);
        if(!r?.signedXDR) throw new Error("WalletConnect: no signedXDR");
        return r.signedXDR;
      }
      if(connectionMode==="freighter"){
        const api = await ensureFreighterApi();
        let address = ""; try{ address = await api.getPublicKey(); }catch{}
        if(!address && api.getAddress){ const r=await api.getAddress(); address=r?.address||""; }
        const res = await api.signTransaction(xdr, { networkPassphrase: NETWORK, address });
        if(res?.error) throw new Error(res.error.message||"Freighter: sign failed");
        return res.signedTxXdr || res.signedXDR || res;
      }
      throw new Error("Not connected");
    }

    async function submitToHorizon(signedXdr){
      const resp = await fetch(`${HORIZON}/transactions`,{
        method:"POST",
        headers:{ "Content-Type":"application/x-www-form-urlencoded;charset=UTF-8" },
        body:"tx="+encodeURIComponent(signedXdr)
      });
      const data = await resp.json();
      if(!resp.ok) throw new Error("Horizon error: "+(data?.extras?.result_codes?.transaction||resp.status));
      return data.hash;
    }

    on(signOnlyBtn,"click", async ()=>{
      actionResult.textContent="";
      const xdr = xdrOut.value.trim();
      if(!xdr){ actionResult.textContent="No XDR to sign. Enter key + amount first."; return; }
      try{
        actionResult.textContent="Signingâ€¦";
        const signed = await signCurrent(xdr);
        xdrOut.value = signed;
        actionResult.textContent="Signed XDR âœ“";
        updateActionButtons();
      }catch(e){ console.error(e); actionResult.textContent=e.message||"Signing failed."; }
    });

    on(signSubmitBtn,"click", async ()=>{
      actionResult.textContent="";
      const xdr = xdrOut.value.trim();
      if(!xdr){ actionResult.textContent="No XDR to sign. Enter key + amount first."; return; }
      try{
        actionResult.textContent="Signingâ€¦";
        const signed = await signCurrent(xdr);
        actionResult.textContent="Submittingâ€¦";
        const hash = await submitToHorizon(signed);
        actionResult.innerHTML = `Submitted âœ“ tx: ${hash}<br/>View: https://stellar.expert/explorer/public/tx/${hash}`;
      }catch(e){ console.error(e); actionResult.textContent=e.message||"Sign/submit failed."; }
    });

    on(copyBtn,"click", async ()=>{
      try{ await navigator.clipboard.writeText(xdrOut.value); copyBtn.textContent="Copied!"; setTimeout(()=>copyBtn.textContent="Copy XDR",1500); }
      catch(e){ console.error(e); }
    });

    on(labBtn,"click", ()=>{
      const xdr = xdrOut.value.trim();
      if(!xdr){ actionResult.textContent="Build the XDR first."; return; }
      let encoded = encodeURIComponent(xdr).replace(/%2F/g,'/').replace(/%2B/g,'+').replace(/%3D/g,'=');
      encoded = encoded.replace(/\//g,'//') + ';;';
      window.open('https://lab.stellar.org/transaction/sign?$=network$id=mainnet&label=Mainnet&horizonUrl=https:////horizon.stellar.org&rpcUrl=https:////mainnet.sorobanrpc.com&passphrase=Public%20Global%20Stellar%20Network%20/;%20September%202015;&transaction$sign$activeView=overview&importXdr='+encoded, "_blank");
    });

    // Initialize buttons based on empty state
    updateActionButtons();
  </script>

  <noscript style="color:#fff">Enable JavaScript to use the AQUAm25 locker.</noscript>
</body>
</html>
