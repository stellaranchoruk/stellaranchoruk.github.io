<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Mirrasets — Locker (v15 demo, layout adj.)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root { --bg:#0b0f12; --panel:#12181d; --ink:#e8f0f6; --muted:#94a3ad; --accent:#7d4bd1; --err:#ff6b6b; --border:#1c242c; }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:980px;margin:28px auto;padding:0 16px}
  .top{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  h1{margin:0;font-size:20px;letter-spacing:.3px}
  .muted{color:var(--muted)} .small{font-size:12px;opacity:.92}
  button{cursor:pointer;font-weight:700;border-radius:12px;border:1px solid #253244;background:#0f1824;color:#e7f2ff;padding:11px 14px;transition:.15s}
  button:hover{filter:brightness(1.08)} button.ghost{background:#141b22;border-color:#2a3340}
  button:disabled{opacity:.55;cursor:not-allowed}
  input,textarea{width:100%;padding:12px;border-radius:16px;border:1px solid #1e2831;background:#0e1419;color:#fff}

  .card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:22px}
  #lockerCard{max-width:520px;margin:6px auto 0;position:relative}
  .slab{background:#0f1520;border:1px solid #1b2633;border-radius:22px;padding:16px;margin-bottom:12px}
  .slab-top{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:6px}
  .slab-label{font-size:14px;color:var(--muted)}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}

  .asset-chip{display:inline-flex;align-items:center;gap:10px}
  .chip-pill{display:inline-flex;align-items:center;gap:8px;padding:7px 10px;border-radius:999px;border:1px solid #1e2831;background:#0e1419}
  .icon{width:32px;height:32px;border-radius:50%;background:#6b4dd8;display:inline-block}

  .pill{display:inline-flex;align-items:center;gap:6px;padding:5px 10px;border-radius:999px;background:#0e1627;border:1px solid #2a3656;color:#cfe0ff;font-size:12px}
  .pill.clickable{cursor:pointer}
  .i-ico{width:18px;height:18px;border-radius:50%;border:1px solid #2a3340;background:#0c1520;color:#cfe0ff;font-size:12px;display:inline-flex;align-items:center;justify-content:center;cursor:pointer}

  .right-stack{display:flex;flex-direction:column;align-items:flex-end;gap:6px;margin-top:2px}
  .percent-btns button{padding:8px 10px;border-radius:10px}

  .popover{position:absolute;z-index:50;right:8px;top:94px;background:#0f1526;border:1px solid #26324a;border-radius:12px;padding:10px 12px;min-width:240px;max-width:320px;text-align:left;display:none;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .popover.open{display:block}
  .popover .line{display:flex;justify-content:space-between;gap:10px;font-size:12px;color:#cfe0ff;padding:3px 0}
  .popover .muted{color:#9db0c6}

  .big-input{
    width:100%;border:1px solid #1e2831;background:#0e1419;color:#fff;border-radius:16px;padding:10px 12px;margin-top:8px;
    font-variant-numeric:tabular-nums;font-size:clamp(20px,5.4vw,32px);line-height:1.15;font-weight:700
  }

  .actions{display:flex;gap:10px;margin-top:10px}
  .primary{flex:1;background:var(--accent);border-color:#8b66d8;color:#fff}
  .divider{height:1px;background:#1a232c;margin:10px 0 8px}

  /* Toasts (v4-lite) */
  .toast-wrap{position:fixed;right:18px;top:18px;z-index:9;display:grid;gap:10px;width:min(92vw,420px);pointer-events:none}
  .toast{pointer-events:auto;display:grid;grid-template-columns:28px 1fr auto;align-items:start;gap:10px;
    padding:12px 14px;border-radius:14px;border:1px solid #253244;background:#0f1a24;color:#e7f2ff;box-shadow:0 12px 28px rgba(0,0,0,.35)}
  .toast.ok{border-color:#214a3a;background:#0f1f1a}.toast.err{border-color:#5a2a2a;background:#201114}
  .toast .ico{width:28px;height:28px;border-radius:999px;display:flex;align-items:center;justify-content:center;background:#1a2a46}
  .toast .x{background:none;border:none;color:#9fb2c6;font-size:18px;cursor:pointer}
</style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <h1>AQUAm25 Locker — Demo</h1>
      <div class="row">
        <button id="demoConnect">Connect (demo)</button>
        <span id="status" class="muted small">Not connected</span>
      </div>
    </div>

    <div class="card" id="lockerCard">
      <h2 style="margin:0 0 8px">Locker</h2>

      <!-- LOCK slab -->
      <div class="slab" style="position:relative">
        <div class="slab-top">
          <div class="slab-label">Lock</div>
          <div class="asset-chip">
            <div class="chip-pill">
              <span class="icon" aria-hidden="true"></span>
              <b>AQUAm25</b>
            </div>
          </div>
        </div>

        <!-- RIGHT column under the asset chip -->
        <div class="right-stack">
          <div class="row" style="gap:8px;align-items:center">
            <span class="muted small">Usable:</span>
            <span id="usablePill" class="pill clickable" title="Tap to fill input">0.0000000</span>
            <span id="usableInfo" class="i-ico" title="Details">i</span>
          </div>
          <div class="row percent-btns">
            <button data-p="25" class="ghost small">25%</button>
            <button data-p="50" class="ghost small">50%</button>
            <button data-p="75" class="ghost small">75%</button>
            <button data-p="100" class="ghost small">MAX</button>
          </div>
        </div>

        <input id="amount" class="big-input" type="number" step="any" inputmode="decimal" placeholder="0" />
        <!-- Popover -->
        <div id="usablePopover" class="popover" role="dialog" aria-modal="false" aria-live="polite"></div>
      </div>

      <!-- DURATION slab (fixed 12 months) -->
      <div class="slab">
        <div class="slab-top" style="margin-bottom:4px">
          <div class="slab-label">Duration</div>
          <span class="pill">12 months</span>
        </div>
      </div>

      <!-- PREVIEW slab -->
      <div class="slab">
        <div class="slab-label" style="margin-bottom:6px">Lock preview</div>
        <div class="row" style="gap:8px;margin:2px 0">
          <span class="small muted" style="min-width:82px">Lock Start:</span>
          <span id="whenStart" class="pill">—</span>
        </div>
        <div class="row" style="gap:8px;margin:2px 0">
          <span class="small muted" style="min-width:82px">Lock End:</span>
          <span id="whenEnd" class="pill">—</span>
        </div>
        <div id="previewLine" class="small muted" style="margin-top:6px">Enter an amount to preview your lock.</div>
      </div>

      <div class="actions">
        <button id="build" class="primary">Build XDR</button>
        <button id="copy" class="ghost">Copy XDR</button>
      </div>

      <div class="divider"></div>
      <div class="row" style="justify-content:space-between">
        <label for="xdr" style="margin:0">Locker Transaction XDR</label>
        <button id="toggleXdr" class="ghost small" style="padding:8px 10px">Reveal</button>
      </div>
      <textarea id="xdr" rows="7" placeholder="Built XDR appears here" style="display:none" readonly></textarea>

      <p class="small muted" style="margin-top:8px">
        Demo page: no SDKs or network calls; Usable popover is sample data.
      </p>
    </div>
  </div>

  <!-- Toasts -->
  <div class="toast-wrap" id="toasts" aria-live="polite"></div>

<script>
  const $=id=>document.getElementById(id);
  const fmt7 = v => (Number(v||0)).toFixed(7).replace(/\.?0+$/,'');
  const toast = (msg,type="ok")=>{
    const box=$("toasts");
    const el=document.createElement("div");
    el.className=`toast ${type}`;
    el.innerHTML=`<div class="ico">${type==="ok"?"✓":type==="err"?"!":"ℹ︎"}</div><div>${msg}</div><button class="x">×</button>`;
    box.appendChild(el);
    const close=()=>el.remove(); el.querySelector(".x").onclick=close; setTimeout(close,2600);
  };

  // Demo “connection” & balances
  let connected=false;
  let usable=0;
  $("demoConnect").onclick = ()=>{
    connected=!connected;
    $("status").textContent = connected ? "Connected (demo)" : "Not connected";
    if(connected){ usable=1200; $("usablePill").textContent = fmt7(usable); toast("Wallet connected (demo)","ok"); }
    else{ usable=0; $("usablePill").textContent = "0.0000000"; $("amount").value=""; $("xdr").value=""; toast("Disconnected","ok"); }
    updatePreview();
    hydratePopover();
  };

  // Usable pill click → autofill input
  $("usablePill").addEventListener("click", ()=>{
    if(!connected){ toast("Connect first (demo).","err"); return; }
    $("amount").value = fmt7(usable);
    updatePreview();
  });

  // Percent buttons (based on usable)
  document.querySelectorAll("[data-p]").forEach(b=>{
    b.addEventListener("click", ()=>{
      if(!connected){ toast("Connect first (demo).","err"); return; }
      const pct = Number(b.dataset.p)/100;
      $("amount").value = fmt7(usable * pct);
      updatePreview();
    });
  });

  // Info popover (sample content)
  const infoBtn = $("usableInfo");
  const pop = $("usablePopover");
  function hydratePopover(){
    pop.innerHTML = `
      <div class="line"><span class="muted">AQUAm25 balance</span><span>${fmt7(connected?1234.5678901:0)}</span></div>
      <div class="line"><span class="muted">In active offers</span><span>${fmt7(connected?34.5678901:0)}</span></div>
      <div class="line"><span class="muted"><b>Usable</b></span><span><b>${fmt7(usable)}</b></span></div>
    `;
  }
  hydratePopover();

  let sticky=false;
  function openPop(){ pop.classList.add("open"); }
  function closePop(){ pop.classList.remove("open"); sticky=false; }
  infoBtn.addEventListener("mouseenter", openPop);
  infoBtn.addEventListener("mouseleave", ()=>{ if(!sticky) closePop(); });
  pop.addEventListener("mouseenter", openPop);
  pop.addEventListener("mouseleave", closePop);
  infoBtn.addEventListener("click",(e)=>{ e.stopPropagation(); sticky = !sticky; sticky?openPop():closePop(); });
  document.addEventListener("click",(e)=>{ if(!pop.contains(e.target) && !infoBtn.contains(e.target)) closePop(); }, {passive:true});

  // Amount input → preview
  $("amount").addEventListener("input", updatePreview);

  function updatePreview(){
    const amt = Number($("amount").value||0);
    const now = new Date();
    const end = new Date(now); end.setMonth(end.getMonth()+12);
    $("whenStart").textContent = now.toLocaleString();
    $("whenEnd").textContent   = end.toLocaleString(undefined,{timeZone:"UTC", timeZoneName:"short"});
    $("previewLine").textContent = amt>0
      ? `Locking ${amt.toLocaleString()} AQUAm25 for 12 months`
      : "Enter an amount to preview your lock.";
  }

  // Build / Copy / Toggle (demo)
  $("build").onclick = ()=>{
    const amt = Number($("amount").value||0);
    if(!connected){ toast("Connect your wallet first (demo).","err"); return; }
    if(!(amt>0)){ toast("Enter a valid amount.","err"); return; }
    $("xdr").value = btoa(`LOCK|AQUAm25|amount=${amt}|months=12|ts=${Date.now()}`);
    toast("XDR built (demo).","ok");
  };
  $("copy").onclick = async ()=>{
    const v=$("xdr").value.trim(); if(!v){ toast("Nothing to copy yet.","err"); return; }
    try{ await navigator.clipboard.writeText(v); toast("XDR copied.","ok"); }catch{ toast("Copy failed.","err"); }
  };
  $("toggleXdr").onclick = ()=>{
    const tx=$("xdr"); const show = tx.style.display==="none";
    tx.style.display = show ? "block":"none";
    $("toggleXdr").textContent = show ? "Hide" : "Reveal";
  };

  updatePreview();
</script>
</body>
</html>
